<div class="wrapper workplace-page">
  <div class="container ">
    <div class="row workplace-nav">
      <!--    Bande de navigation  -->
      <div>
        <%= link_to workplaces_path, class: "btn btn-workplace" do %>
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        <h4>Back to the map</h4>
        <% end %>
      </div>
      <!--    People already cheked in  -->
      <div class="checked-in">
              <% @visits.each do |visit| %>
                <% user = User.find(visit.user_id) %>
                <% avatar_url = user.facebook_picture_url || "http://placehold.it/40x40" %>
                 <div class="user-checkedin">
                    <%= image_tag avatar_url, class: "avatar" %>
                    <p><%= user.first_name %></p>
                </div>
                <p><%# visit.status unless visit.status.nil? %></p>
              <% end %>

      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-9 col-lg-9 col-xl-9 workplace-info">
        <!--    Photo workplace   -->
        <div class ="workplace-photo">
          <%= cl_image_tag @workplace.photo.url unless @workplace.photo.url.nil? %>
        </div>
      <!--    Details infos  -->
        <h3><%= @workplace.name %></h3>
        <h5><%= @workplace.address %></h5>
        <div class="features">
          <ul class="list-unstyled"><% @workplace.features.each do |feature| %>
            <li><%= image_tag(feature.icon) %> <%= feature.name %></li>
            <% end %>
          </ul>
        </div>
        <!--    Ratings  -->
        <div class="ratings">


        </div>
        <!--    Reviews -->
        <div class="reviews">
          <% if @workplace.reviews.nil? %>
            <p>This place doesn't have any review yet. <br/>
              Be the first one to add one :)
            </p>
            <%= link_to "Add a review", new_workplace_review_path %>
            <% else %>
            <h3>Reviews:</h3>
            <% @workplace.reviews.each do |review| %>
              <% @user = User.find(review.user_id) %>
              <div>Review by <strong><%= @user.first_name %> <%= @user.last_name %></strong>
              </%></div>
              <div class="review-comment">
                <p>Comment: <%= review.comment %></p>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>


      <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3 action-workplace">
        <div class="action-user">
          <div class="action-header">
            <% if @workplace.google_id.nil? || @spot.opening_hours.nil? %>
              <div class="led-box">
                <div class="led-yellow"></div>
                <p>Opening hours are not available for this place.</p>
              </div>
              <% elsif @spot.opening_hours["open_now"] %>
              <div class="led-box">
                <div class="led-green"></div>
                <p>OPEN NOW</p>
              </div>
              <% else %>
              <div class="led-box">
                <div class="led-red"></div>
                <p>CLOSED NOW</p>
               </div>
            <% end %>
          </div>
          <div>
            <% if @checkedin_visit == false || @visit.workplace == @workplace %>
              <div id="checkin">
                <%= render 'visits/checkin', visit: @visit, workplace: @workplace %>
              </div>
            <% end %>
          </div>
        </div>

        <div class="row">
          global Ratings
        </div>
        <div>
          Add to Favorites
        </div>
        <div>
          Share with friends
        </div>
        <div>
          I'm going
        </div>
        <% end %>
      </div>
      <div>
        <% if @checkedin_visit == false || @visit.workplace == @workplace %>
          <div id="checkin">
            <%= render 'visits/checkin', visit: @visit, workplace: @workplace %>
          </div>
        <% end %>
      </div>
    </div>
    <div id="present">
      <%= render 'visits/present', visits: @visits %>
    </div>
    <div class="row">
      <div class="col">
        <div id="map" style="width: 100%; height: 600px;"></div>
      </div>
    </div>
  </div>
</div>

<div id="map" class = "row" style="width: 100%; height: 600px;"></div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTiqJOTZ0WFaiV-EP7hsFFi2cBhYnfP8A"></script>

<% content_for(:after_js) do %>
<%= javascript_tag do %>
$(document).ready(function() {
var handler = Gmaps.build('Google');
handler.buildMap({ provider: { draggable: false, zoomControl: false, scrollwheel: false, disableDoubleClickZoom: true }, internal: { id: 'map' } }, function() {
markers = handler.addMarkers(<%= raw @hash.to_json %>);
handler.bounds.extendWith(markers);
handler.fitMapToBounds();
if (markers.length == 0) {
handler.getMap().setZoom(2);
} else if (markers.length == 1) {
handler.getMap().setZoom(16);
}
});
});
<% end %>
<% end %>
