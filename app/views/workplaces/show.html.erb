<div class="wrapper workplace-page">
  <div class="container ">
    <div class="row workplace-nav">
      <!--    Bande de navigation  -->
      <div>
        <%= link_to workplaces_path, class: "btn btn-workplace" do %>
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        <h4>Back to the map</h4>
        <% end %>
      </div>

    </div>

    <div class="row">
      <div class="col-sm-12 col-md-9 col-lg-9 col-xl-9 workplace-info">
        <!--    Photo workplace   -->
        <div class ="workplace-photo">
          <% if @workplace.photo.url.nil? %>
          <%= image_tag 'http://via.placeholder.com/550x350' %>
          <% else %>
          <%= cl_image_tag @workplace.photo.url %>
          <% end %>
        </div>
        <!--    Details infos  -->
        <h1><%= @workplace.name %></h1>
        <h4><%= @workplace.address %></h4>
        <div>
          <p class="ratings-stars"><%= render_stars(@global_rating) %> <%= pluralize @workplace.reviews.size, 'review' %> </p>
        </div>
        <hr>

        <div class="features wp-section">
          <h3>Features</h3>
          <ul class="list-unstyled"><% @workplace.features.each do |feature| %>
            <li>
              <div><%= image_tag(feature.icon) %></div>
              <div><%= feature.name %></div>
            </li>
            <% end %>
          </ul>
        </div>
        <hr>
        <!--    Status of checked-in users  -->
        <div id="status-checkedin">
         <%= render 'users/user-status-checkedin', visit: @visit, workplace: @workplace %>
         <p><%# visit.status unless visit.status.nil? %></p>
       </div>

        
        <hr>
        <!--    Ratings  -->
        <div class="ratings">
          <h3>Ratings</h3>
          <% if @global_rating.nil? %>
            <p>Help the community by rating the place </p>
            <%= link_to "Rate this place", new_workplace_review_path(@workplace) %>
          <% else %>
          <%= @global_rating %>
          <% end %>

        <div class="ratings wp-section">
          <h3>Ratings</h3>
          <table>
            <tr>
              <td> Wifi: </td>
              <td><%= render_stars(average_feature_rating :wifi) %> </td>
            </tr>
            <tr>
              <td> noise: </td>
              <td> <%= render_stars(average_feature_rating :noise) %></td>
            </tr>
            <tr>
              <td> Comfort: </td>
              <td><%= render_stars(average_feature_rating :comfort) %> </td>
            </tr>
            <tr>
              <td> Service: </td>
              <td> <%= render_stars(average_feature_rating :service) %> </td>
            </tr>
          </table>
        </div>
        <hr>
        <!--    Reviews -->
        <div class="reviews wp-section">
          <h3>Reviews</h3>
          <% if @global_rating.nil? %>

          <p>This place doesn't have any review yet. <br/>
            Be the first one to add one :)
          </p>
          <%= link_to "Add a review", new_workplace_review_path(@workplace) %>
          <% else %>
          <h3>Reviews:</h3>
          <% @workplace.reviews.each do |review| %>
          <% @user = User.find(review.user_id) %>
          <div>Review by <strong><%= @user.first_name %> <%= @user.last_name %></strong>
          </%></div>
          <div> <%= render_stars(review.ratings.first.average) %></div>
          <div class="review-comment">
            <p><u>Comment: </u> <%= review.comment %></p>
          </div>
          <% end %>
          <% end %>
        </div>
      </div>


      <div class="col-sm-12 col-md-3 col-lg-3 col-xl-3 " id="action-bar" >
        <div class="action-workplace">
          <div class="action-header">
            <% if @workplace.google_id.nil? || @spot.opening_hours.nil? %>
            <div class="workplace-hours">
              <p>Opening hours are not available for this place.</p>
            </div>
            <% elsif @spot.opening_hours["open_now"] %>
            <div class="workplace-hours">
              <p>Open Now</p>
            </div>

            <% else %>
            <div class="workplace-hours">
              <p>CLOSED NOW</p>
            </div>
            <% end %>
          </div>

          <div class="action-body">
             <span>Add to Favorites</span>
            <!-- <i class="fa fa-share-alt" aria-hidden="true"></i> -->
             <span>Share with friends</span>
             <!-- <i class="fa fa-plus" aria-hidden="true"></i> -->
             <span>Send to my iphone</span>
             <!-- <i class="fa fa-mobile" aria-hidden="true"></i>  -->
          </div>
          <div class="action-footer">
            <% if @checkedin_visit == false || !@visitrender.nil? && @visitrender_stars.workplace == @workplace  %>
            <div id="checkin">
              <%= render 'visits/checkin', visit: @visit, workplace: @workplace %>
            </div>
            <% end %>
          </div>
        </div>
        <!--    People already cheked in  -->
        <div id="present" class="checked-in">
          <% if @visitrender.nil? %>
          <p> Let people know where you are working today</p>
          <% else %>
          <%= render 'visits/present', visit: @visit, workplace: @workplace %>
          <p><%# visit.status unless visit.status.nil? %></p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="map" class = "row" style="width: 100%; height: 400px;"></div>

<div id="map" class = "row" style="width: 100%; height: 400px;"></div>
<div id="wrapper-modal-status">
  <%= render 'shared/modal_status', locals: { workplace: @workplace,status: @status } %>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDTiqJOTZ0WFaiV-EP7hsFFi2cBhYnfP8A"></script>


<% content_for(:after_js) do %>
<%= javascript_tag do %>
$(document).ready(function() {
var handler = Gmaps.build('Google');
handler.buildMap({ provider: { draggable: false, zoomControl: false, scrollwheel: false, disableDoubleClickZoom: true }, internal: { id: 'map' } }, function() {
markers = handler.addMarkers(<%= raw @hash.to_json %>);
handler.bounds.extendWith(markers);
handler.fitMapToBounds();
if (markers.length == 0) {
handler.getMap().setZoom(2);
} else if (markers.length == 1) {
handler.getMap().setZoom(16);
}
});

});

<% end %>
<% end %>
